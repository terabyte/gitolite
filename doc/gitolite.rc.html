<p><head><style>
    body        { margin-left:  40px;   font-size:  0.9em;  font-family: sans-serif; max-width: 800px; }
    h1          { margin-left: -30px;   border-bottom: 5px  solid #ccc; }
    h2, h3      { margin-left: -30px;   border-top:    3px  solid #ddd; }
    h4, h5      { margin-left: -20px; }
    code        { font-size:    1.1em;  background:  #eee; }
    pre         { margin-left:  2em;    background:  #eee; }
    pre code    { font-size:    1.1em;  background:  #eee; }
</style></head></p>

<h1>configuring gitolite's advanced features -- the <code>.gitolite.rc</code> file</h1>

<p>This is the documentation for the contents of the "rc" file
(<code>$HOME/.gitolite.rc</code>) on the server.  Until now this documentation was
inline, within the rc file itself, but it has grown too large, too unwieldy,
and too difficult to grok for people new to gitolite.</p>

<p>The documentation follows approximately the same order as the sample variables
in the (now reorganised) example "rc" file.</p>

<p>In this document:</p>

<ul>
<li><a href="#_variables_that_should_not_be_touched_at_all">variables that should not be touched at all</a></li>
<li><a href="#_most_often_used_changed_variables">most often used/changed variables</a></li>
<li><a href="#_variables_with_an_efficiency_performance_impact">variables with an efficiency/performance impact</a></li>
<li><a href="#_variables_with_a_security_impact">variables with a security impact</a></li>
<li><a href="#_less_used_changed_variables">less used/changed variables</a></li>
<li><a href="#_rarely_changed_variables">rarely changed variables</a></li>
<li><a href="#_constants_that_aren_t_">constants that aren't!</a></li>
</ul>

<p>[Note: in perl, there is no actual boolean.  The undefined value, the number
'0', and the empty string, are all 'false'.  Everything else is 'true'.  It is
thus common to use just 0/1 for false/true].</p>

<p><a name="_variables_that_should_not_be_touched_at_all"></a></p>

<h3>variables that should not be touched at all</h3>

<p>The first section does not need too much elaboration.  Let's just say bad
things happen if you change them.</p>

<p><a name="_most_often_used_changed_variables"></a></p>

<h3>most often used/changed variables</h3>

<ul>
<li><p><code>$GL_WILDREPOS</code>, boolean, default 0</p>

<p>Setting this variable lets your users create repositories based on wild
cards, hand out R and RW permissions to other users to collaborate, etc.</p>

<p>See <a href="http://sitaramc.github.com/gitolite/doc/wildcard-repositories.html">doc/wildcard-repositories.mkd</a> for lots of info on this.</p></li>
<li><p><code>$PROJECTS_LIST</code>, filename, default <code>~/projects.list</code></p>

<p>This is for gitweb users only.  Gitweb setup has a variable called
<code>$projects_list</code> (please see gitweb docs for more on this).  Set this to
the same value as that one.</p></li>
<li><p><code>$REPO_UMASK</code>, octal, default <code>0077</code></p>

<p>The default UMASK that gitolite uses makes all the repos and their
contents have <code>rwx------</code> permissions.  People who want to run gitweb
realise that this will not do.  The correct way to deal with this is to
change this variable to <code>0027</code> (which gets you <code>rwxr-x---</code>), then add the
apache or httpd user running the webserver as a member of the 'gitolite'
group.</p>

<p>Please note the syntax; the leading 0 is required.  If you change it
<em>after</em> the install is complete, you'll have to do some chmod's also to
adjust permissions of files and directories that have already been
created.</p></li>
</ul>

<p><a name="_variables_with_an_efficiency_performance_impact"></a></p>

<h3>variables with an efficiency/performance impact</h3>

<ul>
<li><p><code>$GL_BIG_CONFIG</code>, boolean, default 0</p>

<p>This is the most common setting for efficiency in handling large repo/user
groups.  This is a very powerful setting; please read
<a href="http://sitaramc.github.com/gitolite/doc/big-config.html">doc/big-config.mkd</a> for all the details you might need.</p>

<p>There are 3 other settings related to big configs.  They are changed only
in rare cases, however, so are described later.</p></li>
<li><p><code>$GL_NO_DAEMON_NO_GITWEB</code>, boolean, default 0</p>

<p>If you have <em>lots</em> of repos, and you're <em>not</em> using gitweb or daemon, you
should probably set this on for efficiency.  Despite the name, it also
blocks repo config settings.  Please read <a href="http://sitaramc.github.com/gitolite/doc/big-config.html">doc/big-config.mkd</a> for
more details.</p></li>
<li><p><code>$GL_NICE_VALUE</code>, boolean, default undef</p>

<p>The nice value to run under.  Applicable only if it is greater than 0.
Please do NOT set it if your bits/resource.h does not define PRIO_PROCESS
is 0.  For Linux this is true...</p></li>
</ul>

<p><a name="_variables_with_a_security_impact"></a></p>

<h3>variables with a security impact</h3>

<p><strong>IMPORTANT NOTE</strong></p>

<p>This section describes variables that, if not carefully used, can cause
security issues.  It also includes variables which I personally do not use and
do not have the ability to test thoroughly</p>

<p>Using non-default value for these variables voids the security reward in the
README.  This does <em>not</em> mean they are less important or that I will ignore
problems; it just means <em>my</em> ability to catch problems may be limited by my
test suite, my actual production use, my time, and sometimes (LDAP comes to
mind) even my skill or resources available to me, and that therefore I depend
on feedback from my users to find or fix issues.</p>

<ul>
<li><p><code>$GL_ALL_READ_ALL</code>, boolean, default undef</p>

<p>Eliminates the access control check for read access.  Makes things much
(<strong>much</strong>!) faster when you have 10,000 projects and the compiled conf
file is more than 20MB in size!  <strong>Double check with your boss or have a
new job lined up before setting this on!</strong></p></li>
<li><p><code>$GIT_PATH</code>, string, default empty</p>

<p>If git on your server is on a standard path (that is <code>ssh git@server git
--version</code> works), leave this setting as is.  Otherwise, find out where it
is and use that value here, for example <code>GIT_PATH="/opt/bin/";</code></p></li>
<li><p><code>$GL_GITCONFIG_KEYS</code>, string, default empty</p>

<p>This setting allows the repo admin to define acceptable gitconfig keys.</p>

<p>Gitolite allows you to set git repo options using the "config" keyword;
see doc/gitolite.conf.mkd for details and syntax.</p>

<p>However, if you are in an installation where the repo admin does not (and
should not) have shell access to the server, then allowing him to set
arbitrary repo config options <em>may</em> be a security risk -- some config
settings allow executing arbitrary commands!</p>

<p>You have 3 choices.  By default <code>$GL_GITCONFIG_KEYS</code> is left empty, which
completely disables this feature (meaning you cannot set git configs via
the repo config).</p>

<p>The second choice is to give it a space separated list of settings you
consider safe.  (These are actually treated as a set of perl regular
expression patterns, and any one of them must match).  For example:
<code>$GL_GITCONFIG_KEYS = "core\\.logAllRefUpdates core\\..*compression";</code>
allows repo admins to set one of those 3 config keys (yes, that second
pattern matches two settings from "man git-config", if you look).</p>

<p>The third choice (which you may have guessed already if you're familiar
with regular expressions) is to allow anything and everything:
<code>$GL_GITCONFIG_KEYS = ".*";</code></p>

<p>NOTE that due to some quoting and interpolation issues I have not been
able to look at, a literal "." needs to be specified in this string as
<code>\\.</code> (two backslashes and a dot).  So this is how you'd allow any keys in
the "foo" category: <code>$GL_GITCONFIG_KEYS = "foo\\..*";</code></p></li>
<li><p><code>$GL_GITCONFIG_WILD</code>, boolean, default 0</p>

<p>This setting allows gitconfig keys even for wild repos.  This is an
efficiency issue more than a security issue, since this requires trawling
through all of <code>$REPO_BASE</code> looking for stuff :)</p></li>
<li><p><code>$GL_NO_CREATE_REPOS</code>, boolean, default 0</p>

<p>DO NOT CHANGE THIS unless you have other means to create repos and
correctly populate them with the required hooks.  No hooks, no access
control; you have been warned!</p></li>
<li><p><code>$GL_NO_SETUP_AUTHKEYS</code>, boolean, default 0</p>

<p>DO NOT CHANGE THIS unless you have other means to setup the authkeys file
(<code>~/.ssh/authorized_keys</code>).  In an extreme case, if you switch this on
without also fixing up the authkeys file, users who you think you deleted
may still have access.  All in all, please be careful, as with any change
that affects ssh.</p></li>
<li><p><code>$GL_WILDREPOS_DEFPERMS</code>, string, default undef</p>

<p>This sets default wildcard permissions for newly created wildcard repos.</p>

<p>If set, this value will be used as the default user-level permission rule
of new wildcard repositories. The user can change this value with the
setperms command as desired after repository creation; it is only a
default.</p>

<p>Example: <code>$GL_WILDREPOS_DEFPERMS = 'R @all';</code></p></li>
<li><p><code>$HTPASSWD_FILE</code>, string, default empty</p>

<p>Gitolite can help users run the htpasswd command in a secure manner (since
gitolite has already identified them by an ssh key).  If you want to
enable this, give the variable the absolute path to whatever file apache
(etc) expect to find the passwords in.</p>

<p>Look in <a href="http://sitaramc.github.com/gitolite/doc/3-faq-tips-etc.html">doc/3-faq-tips-etc.mkd</a> ("easier to link gitweb
authorisation with gitolite" section) for more details on using this
feature.</p></li>
<li><p><code>$RSYNC_BASE</code>, string, default empty</p>

<p>Gitolite can be used to allow fine grained control of the rsync command.</p>

<p>This setting enables the rsync external command helper, by specifying the
base path of all the files that are accessible via rsync.  It must be an
absolute path, like <code>$RSYNC_BASE = "/home/git/up-down";</code>.  Leave it
undefined or set to the empty string to disable the rsync helper.</p>

<p>When enabled, it runs rsync with specific arguments, all presumably filled
in correctly by the client-side rsync. However, I am not an expert on how
rsync may be abused, so if it breaks, you get to keep both pieces!</p></li>
<li><p><code>$SVNSERVE</code>, string, default empty</p>

<p>Gitolite can also be used to gate access (though not at a fine grained
level) to SVN if needed, passing authentication information on to
<code>svnserve</code>.  This setting allows launching svnserve when requested by the
ssh client.  This allows using the same SSH setup for both SVN and git
access. Leave it undefined or set to the empty string to disable svnserve
access.</p>

<p>The setting will look something like (where the %u is substituted with the
username):</p>

<pre><code>$SVNSERVE = "/usr/bin/svnserve -r /var/svn/ -t --tunnel-user=%u";
</code></pre></li>
<li><p>hook chaining</p>

<ul>
<li><code>$UPDATE_CHAINS_TO</code>, string, default "hooks/update.secondary"</li>
<li><code>$ADMIN_POST_UPDATE_CHAINS_TO</code>, string, default
"hooks/post-update.secondary"</li>
</ul>

<p>By default, the update hook in every repo chains to "update.secondary".
Similarly, the post-update hook in the admin repo chains to
"post-update.secondary".  If you're fine with the defaults, there's no
need to do anything here.  However, if you want to use different names or
paths, change these variables.</p></li>
<li><p><code>$GL_ADC_PATH</code>, string, default undef</p>

<p>This setting enables admin defined commands.</p>

<p><strong>WARNING</strong>: Use this feature only if (a) you really know what you're
doing and (b) you really, <strong>really</strong>, know what you're doing!  Please read
<a href="http://sitaramc.github.com/gitolite/doc/admin-defined-commands.html">doc/admin-defined-commands.mkd</a> for details.  This is an extremely
powerful and flexible feature, and naturally anything that flexible can be
a security risk!</p></li>
<li><p><code>$GL_GET_MEMBERSHIPS_PGM</code>, string, default undef</p>

<p>Some sites would like to store group membership outside gitolite, because
they already have it in (usually) their LDAP server, and it doesn't make
sense to be forced to duplicate this information.</p>

<p>Set the following variable to the name of a script that, given a username
as argument, will return a list of groups that she is a member of.  See
<a href="http://sitaramc.github.com/gitolite/doc/big-config.html">doc/big-config.mkd</a> for more details.</p>

<p>Example: <code>$GL_GET_MEMBERSHIPS_PGM = "/usr/local/bin/expand-ldap-user-to-groups"</code></p></li>
<li><p><code>$GL_HTTP_ANON_USER</code>, string, default undef</p>

<p><p>Analogous to running mob branches over ssh (as described in
<a href="http://sitaramc.github.com/gitolite/doc/mob-branches.html">doc/mob-branches.mkd</a>, this variable -- combined with appropriate
setup described in <a href="http://sitaramc.github.com/gitolite/doc/http-backend.html">doc/http-backend.mkd</a> -- lets you pretend to
gitolite that unauthenticated HTTP users are actually authenticated as
this user.</p></li>
</ul>
<a name="_less_used_changed_variables"></a></p>

<h3>less used/changed variables</h3>

<ul>
<li><p><code>$GL_ALL_INCLUDES_SPECIAL</code>, boolean, default undef</p>

<p>Giving access to @all users (as in <code>R  =  @all</code>) in the config normally
does <em>not</em> include the special users "gitweb" and "daemon".  If you want
@all to include these two users, set this variable.</p></li>
<li><p>mirroring setup</p>

<p>These two variables enable mirroring support; see
<a href="http://sitaramc.github.com/gitolite/doc/mirroring.html">doc/mirroring.mkd</a> for details.  The two variables are
<code>$GL_SLAVE_MODE</code>, (boolean, default undef), and <code>$ENV{GL_SLAVES}</code>,
(environment variable, string, default undef)</p>

<p>Note on the second variable above: you must use single quotes to give it
its value, not double quotes, (like <code>$ENV{GL_SLAVES} = 'gitolite@server2
gitolite@server3';</code>).  Also note that this is an environment variable, not
a regular perl variable, so mind the syntax if you're not a perl guy :-)</p></li>
<li><p><code>$GL_WILDREPOS_PERM_CATS</code>, string, default "READERS WRITERS"</p>

<p>Originally, we only allowed "R" and "RW" in the setperms command.  Now we
allow the admin to define other categories as she wishes (example:
MANAGERS, TESTERS, etc).</p>

<p>This variable is a space-separated list of the allowed categories.</p>

<p>PLEASE, <em>PLEASE</em>, read the section in
<a href="http://sitaramc.github.com/gitolite/doc/wildcard-repositories.html">doc/wildcard-repositories.mkd</a> for caveats and warnings.  This is a
VERY powerful feature and if you're not careful you could mess up the ACLs
nicely.</p>

<p>This is the internal default if you don't set it (like if you didn't
update your ~/.gitolite.rc with new variables when you upgraded gitolite):</p>

<pre><code>$GL_WILDREPOS_PERM_CATS = "READERS WRITERS";
</code></pre>

<p>You can use your own categories in addition to the standard ones; I
suggest you include READERS and WRITERS for backward compatbility though:</p>

<pre><code>$GL_WILDREPOS_PERM_CATS = "READERS WRITERS MANAGERS TESTERS";
</code></pre></li>
</ul>

<p><a name="_rarely_changed_variables"></a></p>

<h3>rarely changed variables</h3>

<ul>
<li><p><code>$GL_LOGT</code>, string, default <code>$GL_ADMINDIR/logs/gitolite-%y-%m.log</code></p>

<p>This is the template for location of the log files and format of their
names.</p>

<p>The default produces files like <code>~/.gitolite/logs/gitolite-2009-09.log</code>.
If you make up your own templates, <strong>PLEASE MAKE SURE</strong> the directory
exists and is writable; gitolite won't do that for you unless it is the
default, ("$GL_ADMINDIR/logs")</p></li>
<li><p><code>$GL_PERFLOGT</code>, string, default undef</p>

<p>This gives the location of the performance log files.  Uncomment and set
this variable if you want performance logging.  Performance log files are
kept separate from access log files because they store different, usually
much shorter term, information.</p></li>
<li><p><code>$GL_SITE_INFO</code>, string, default undef</p>

<p>Some installations would like to give their users customised information
(like a link to their own websites, for example) so that users have a
quick way to find some links or information.</p>

<p>If this variable is defined, the "info" command will print it at the end
of the listing.</p></li>
<li><p><code>$REPO_BASE</code>, string, default "repositories"</p>

<p>This is where all the repos go.  If it's not an absolute path, it is
considered to be relative to $HOME.  Moving all the repositories after the
install has completed is doable: just <a href="http://sitaramc.github.com/gitolite/doc/3-faq-tips-etc.html#_disabling_write_access_to_take_backups">disable writes</a> to gitolite,
move <code>~/repositories/*</code>, change this variable, then re-enable writes.</p></li>
</ul>

<p><a name="_constants_that_aren_t_"></a></p>

<h3>constants that aren't!</h3>

<p>The source file <code>src/gitolite_rc.pm</code> defines a few "constants", for example:</p>

<pre><code>$R_COMMANDS=qr/^(git[ -]upload-pack|git[ -]upload-archive)$/;
</code></pre>

<p>Let's say you want to disallow the archive feature, you would need to change
this constant.</p>

<p>As of this version, you can now change these "constants" also, simply by
defining a new value for any or all of them in your <code>~/.gitolite.rc</code> file.</p>

<p>If you use this to relax some of the patterns involved (for example, the value
of <code>ADC_CMD_ARGS_PATT</code>), please be sure you know what you're doing.</p>
